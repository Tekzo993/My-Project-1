<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ü–æ—Ç–æ–∫–∏ –∏ —Å–∏—Å—Ç–µ–º–∞ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞ - URcode</title>
    <link rel="stylesheet" href="styles.css">
    <script type="module" src="firebase.js"></script>
</head>
<body>
    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="logo">URcode</div>
            <ul class="nav-links">
                <li><a href="index.html" class="nav-link" data-tab="theory">–ö—É—Ä—Å—ã</a></li>
                <li><a href="operators.html" class="nav-link">–ü–æ–∏—Å–∫</a></li>
                <li><a href="assistant.html" class="nav-link">–ê—Å—Å–∏—Å—Ç–µ–Ω—Ç</a></li>
                <li><a href="settings.html" class="nav-link" data-tab="settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</a></li>
            </ul>
            <div class="nav-right">
                <li><a href="" class="nav-link" data-tab=""></a></li>
            </div>
        </div>
    </nav>

    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <main class="container">
        <!-- –ö–Ω–æ–ø–∫–∞ –ù–∞–∑–∞–¥ –ø–æ–≤—ã—à–µ -->
        <div class="back-top-container">
            <a href="index.html" class="back-top-btn">
                <span class="back-arrow">‚Üê</span>
                –ù–∞–∑–∞–¥ –∫ —Ç–µ–æ—Ä–∏–∏
            </a>
        </div>

        <div class="lesson-container-dynamic">
            <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
            <aside class="lesson-sidebar-dynamic">
                <div class="lesson-nav-dynamic">
                    <h3>–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —É—Ä–æ–∫–∞</h3>
                    
                    <!-- –ö–∞–∂–¥—ã–π –ø—É–Ω–∫—Ç —Å –∫–Ω–æ–ø–∫–æ–π –ø–µ—Ä–µ—Ö–æ–¥–∞ -->
                    <!-- –¢–æ–ª—å–∫–æ data-firebase-id, –±–µ–∑ data-lesson -->
                    <div class="lesson-nav-item-dynamic" data-firebase-id="lesson-4">
                        <span class="nav-number-dynamic">1</span>
                        <span class="nav-title-dynamic">–ë–∞–∑–æ–≤—ã–µ —Ç–∏–ø—ã —Ä–∞–±–æ—Ç—ã —Å –ø–æ—Ç–æ–∫–∞–º–∏</span>
                        <button class="open-lesson-btn-dynamic">–û—Ç–∫—Ä—ã—Ç—å</button>
                    </div>
                    
                    <div class="lesson-nav-item-dynamic" data-firebase-id="lesson-4-1">
                        <span class="nav-number-dynamic">2</span>
                        <span class="nav-title-dynamic">–§–∞–π–ª–æ–≤—ã–µ –ø–æ—Ç–æ–∫–∏. –û—Ç–∫—Ä—ã—Ç–∏–µ –∏ –∑–∞–∫—Ä—ã—Ç–∏–µ</span>
                        <button class="open-lesson-btn-dynamic">–û—Ç–∫—Ä—ã—Ç—å</button>
                    </div>
                    
                    <div class="lesson-nav-item-dynamic" data-firebase-id="lesson-4-2">
                        <span class="nav-number-dynamic">3</span>
                        <span class="nav-title-dynamic">–ß—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤</span>
                        <button class="open-lesson-btn-dynamic">–û—Ç–∫—Ä—ã—Ç—å</button>
                    </div>
                    
                    <div class="lesson-nav-item-dynamic" data-firebase-id="lesson-4-3">
                        <span class="nav-number-dynamic">4</span>
                        <span class="nav-title-dynamic">–ü–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –≤–≤–æ–¥–∞ –∏ –≤—ã–≤–æ–¥–∞</span>
                        <button class="open-lesson-btn-dynamic">–û—Ç–∫—Ä—ã—Ç—å</button>
                    </div>
                </div>
            </aside>

            <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç —É—Ä–æ–∫–∞ -->
            <section class="lesson-content-dynamic" id="lessonContent">
                <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —Å—é–¥–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                <div class="welcome-message">
                    <h2>üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —É—Ä–æ–∫ –ø–æ –ø–æ—Ç–æ–∫–∞–º!</h2>
                    <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ–º—É –∏–∑ —Å–ø–∏—Å–∫–∞ —Å–ª–µ–≤–∞, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏–∑—É—á–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–≤ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞ –≤ C++.</p>
                    <p>–ö–æ–Ω—Ç–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏–∑ Firebase...</p>
                </div>
            </section>
        </div>
    </main>

    <script type="module">
        import { db } from './firebase.js';
        import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –∏–∑ Firebase
        let firebaseLessonsContent = {};

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –∏–∑ Firebase –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        async function loadLessonContentFromFirebase() {
            try {
                console.log('üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç —É—Ä–æ–∫–∞ "–ü–æ—Ç–æ–∫–∏ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞" –∏–∑ Firebase...');
                
                // –≠—Ç–æ —Ñ–∞–π–ª index2-3-1.html - –ø–æ—Ç–æ–∫–∏, –∏—Å–ø–æ–ª—å–∑—É–µ–º —É—Ä–æ–≤–µ–Ω—å beginner
                const lessonDoc = await getDoc(doc(db, 'lessons', 'beginner'));
                
                if (lessonDoc.exists()) {
                    const lessons = lessonDoc.data().items;
                    
                    // –ó–ê–ì–†–£–ñ–ê–ï–ú –í–°–ï –£–†–û–ö–ò –ò–ó FIREBASE
                    lessons.forEach(lesson => {
                        firebaseLessonsContent[lesson.id] = {
                            title: lesson.title,
                            content: lesson.content
                        };
                    });
                    
                    console.log('‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω—ã —É—Ä–æ–∫–∏:', Object.keys(firebaseLessonsContent));
                    
                    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫
                    const firstLesson = document.querySelector('.lesson-nav-item-dynamic');
                    if (firstLesson && Object.keys(firebaseLessonsContent).length > 0) {
                        firstLesson.classList.add('active');
                        const firstLessonFirebaseId = firstLesson.getAttribute('data-firebase-id');
                        showLessonContent(firstLessonFirebaseId);
                    }
                } else {
                    showError('–î–æ–∫—É–º–µ–Ω—Ç beginner –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ Firebase');
                }
                
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ Firebase:', error);
                showError('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Firebase: ' + error.message);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —É—Ä–æ–∫–∞
        function showLessonContent(firebaseLessonId) {
            const lessonContent = document.getElementById('lessonContent');
            
            if (firebaseLessonsContent[firebaseLessonId]) {
                const lesson = firebaseLessonsContent[firebaseLessonId];
                
                // –ò–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–ª—å–∫–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ body
                let cleanContent = lesson.content;
                
                // –£–¥–∞–ª—è–µ–º –≤–Ω–µ—à–Ω–∏–µ —Ç–µ–≥–∏ –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
                const bodyMatch = lesson.content.match(/<body[^>]*>([\s\S]*?)<\/body>/i);
                if (bodyMatch && bodyMatch[1]) {
                    cleanContent = bodyMatch[1];
                }
                
                // –¢–∞–∫–∂–µ —É–¥–∞–ª—è–µ–º –≤–æ–∑–º–æ–∂–Ω—ã–µ style —Ç–µ–≥–∏, –æ—Å—Ç–∞–≤—à–∏–µ—Å—è –≤ –∫–æ–Ω—Ç–µ–Ω—Ç–µ
                cleanContent = cleanContent.replace(/<style[^>]*>[\s\S]*?<\/style>/gi, '');
                
                lessonContent.innerHTML = `
                    <div class="lesson-detail-content">
                        ${cleanContent}
                        <div class="lesson-meta">
                            <small>–£—Ä–æ–∫ –ø–æ –ø–æ—Ç–æ–∫–∞–º –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞</small>
                        </div>
                    </div>
                `;
            } else {
                // –ï—Å–ª–∏ –Ω–µ –Ω–∞—à–ª–∏
                showError(`–ö–æ–Ω—Ç–µ–Ω—Ç —É—Ä–æ–∫–∞ ${firebaseLessonId} –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ Firebase.`);
            }
        }

        // –ü–æ–∫–∞–∑ –æ—à–∏–±–∫–∏
        function showError(message) {
            const lessonContent = document.getElementById('lessonContent');
            lessonContent.innerHTML = `
                <div class="lesson-detail-content">
                    <h2>‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h2>
                    <p>${message}</p>
                    <p>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Firebase.</p>
                </div>
            `;
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –ø–æ –∫–Ω–æ–ø–∫–∞–º "–û—Ç–∫—Ä—ã—Ç—å"
        document.addEventListener('DOMContentLoaded', function() {
            const openButtons = document.querySelectorAll('.open-lesson-btn-dynamic');
            
            openButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const lessonItem = this.closest('.lesson-nav-item-dynamic');
                    const firebaseLessonId = lessonItem.getAttribute('data-firebase-id');
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç —É—Ä–æ–∫–∞
                    showLessonContent(firebaseLessonId);
                    
                    // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
                    document.querySelectorAll('.lesson-nav-item-dynamic').forEach(item => {
                        item.classList.remove('active');
                    });
                    lessonItem.classList.add('active');
                });
            });

            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –∏–∑ Firebase
            loadLessonContentFromFirebase();
        });
    </script>
</body>
</html>